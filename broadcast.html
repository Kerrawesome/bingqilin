<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="https://em-content.zobj.net/source/google/387/soft-ice-cream_1f366.png" type="image/png">
    <title>Bing Qilin Stream</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        header { display: flex; align-items: center; }
        header img { height: 3em; margin-right: 1em; }
	body { overflow-x: hidden; padding: 0 15px; margin: 0; }
	h2 { margin: 25px 0 10px 0; padding-bottom: 5px; border-bottom: 1px solid #eee; }
        #tabs button { margin: 10px 5px 15px 0; padding: 5px; }
	*, *::before, *::after { box-sizing: border-box } 
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
	@media (min-width: 500px) { .grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); } }
	.item > div { word-break: break-word; overflow-wrap: break-word; }
        .item { padding: 8px; border: 1px solid #ddd; cursor: pointer; display: flex; flex-direction: column; text-align: center; justify-content: center; }
        .item:hover { background-color: #e9e9e9; }
        .item img { width: 100%; height: 5em; object-fit: contain; margin-bottom: 10px; }
        video { width: 100%; max-width: 100%; aspect-ratio: 16 / 9; background: #000; }
        audio { width: 100%; max-width: 100%; margin-top: 15px; }
	.loader { border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
	<header>
            <img src="https://em-content.zobj.net/source/google/387/soft-ice-cream_1f366.png" alt="Logo">
            <h1>Bing Qilin Stream</h1>
		<p><a href="index.html">media</a></p>
	</header>
        <div id="tabs">
            <button id="btn-tv" onclick="loadPlaylist('tv')">Freeview TV</button>
            <button id="btn-radio" onclick="loadPlaylist('radio')">NZ Radio</button>
        </div>
        <div id="player-container"></div>
        <div id="content"></div>
    <script>
        const content = document.getElementById('content'), player = document.getElementById('player-container');
        const sources = { tv: 'https://i.mjh.nz/nz/raw-tv.m3u8', radio: 'https://i.mjh.nz/nz/raw-radio.m3u8' };
        const loadPlaylist = async (type) => {
            player.innerHTML = '';
            content.innerHTML = `<div class="loader"></div>`;
            document.querySelectorAll('#tabs button').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${type}`).classList.add('active');
            const response = await fetch(sources[type]);
            const lines = (await response.text()).split('\n');
            let main = '', top = '', bottom = '';
            for (let i = 0; i < lines.length; i++) {
                if (!lines[i].startsWith('#EXTINF')) continue;
                const info = lines[i], name = info.split(',').pop(), url = lines[i + 1];
                if (!name || !url || !url.startsWith('http')) continue;
                const isDiscovery = type === 'tv' && /(channel-id|tvg-id)="mjh-discovery/.test(info);
                const logo = info.match(/tvg-logo="([^"]+)"/);
                const itemHtml = `<div class="item" onclick="playStream('${url}', '${type}')">
                    ${isDiscovery ? '' : `<img src="${logo ? logo[1] : 'https://em-content.zobj.net/source/google/387/radio_1f4fb.png'}" onerror="this.style.display='none'">`}
                    <div>${name}</div>
                </div>`;
                if (isDiscovery) bottom += itemHtml;
                else if (type === 'radio' && name.includes('Auckland')) top += itemHtml;
                else main += itemHtml;
            }
            content.innerHTML = (top ? `<h2>Auckland</h2><div class="grid">${top}</div><h2>Other Stations</h2>` : '') +
                                `<div class="grid">${main}</div>` +
                                (bottom ? `<h2>Discovery</h2><div class="grid">${bottom}</div>` : '');
        };
        const playStream = (url, type) => {
            player.innerHTML = `<${type === 'tv' ? 'video' : 'audio'} id="media" controls autoplay></${type === 'tv' ? 'video' : 'audio'}>`;
            const media = document.getElementById('media');
            if (url.endsWith('.m3u8') && Hls.isSupported()) {
                const hls = new Hls(); hls.loadSource(url); hls.attachMedia(media);
            } else { media.src = url; }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        loadPlaylist('tv');
    </script>
</body>
</html>
