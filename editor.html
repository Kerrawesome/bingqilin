<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JSON Preset Editor</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        textarea { width: 100%; height: 400px; }
        button { font-size: 1.2em; padding: 10px 15px; margin-top: 10px; }
        #status { margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Edit presets.json</h1>
    <textarea id="jsonEditor" placeholder="Loading..."></textarea>
    <br>
    <button id="saveButton">Save Changes</button>
    <div id="status"></div>
</body>
    <script>
        // *** IMPORTANT: Replace this with your actual Cloudflare Worker URL ***
        const WORKER_URL = 'https://bingqilin.kerrawesome.workers.dev/';

        const editor = document.getElementById('jsonEditor');
        const saveButton = document.getElementById('saveButton');
        const statusDiv = document.getElementById('status');

       // Function to save the new JSON content via the worker (IMPROVED VERSION)
async function savePresets() {
    statusDiv.textContent = 'Saving...';
    saveButton.disabled = true;

    // 1. Client-side validation: Check for valid JSON before sending
    try {
        JSON.parse(editor.value);
    } catch (error) {
        statusDiv.textContent = `Error: Invalid JSON format in text area. Please fix it. Details: ${error.message}`;
        saveButton.disabled = false;
        return; // Stop here if the JSON is bad
    }

    try {
        const response = await fetch(WORKER_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: editor.value
        });

        // 2. Server-side validation: Check the response from the worker
        if (!response.ok) {
            // If the server returned an error (like 404 Not Found or 500 Server Error),
            // get the error message as plain text.
            const errorText = await response.text();
            throw new Error(`The server returned an error: ${response.status} - ${errorText}`);
        }

        const result = await response.json();

        if (!result.success) {
            throw new Error(result.message || 'The worker reported a failure.');
        }

        statusDiv.textContent = 'Saved successfully!';

    } catch (error) {
        console.error('Error saving presets:', error);
        statusDiv.textContent = `Error: ${error.message}`;
    } finally {
        saveButton.disabled = false;
    }
}

        // Add event listener to the save button
        saveButton.addEventListener('click', savePresets);

        // Load the presets when the page loads
        document.addEventListener('DOMContentLoaded', loadPresets);
    </script>

</html>
